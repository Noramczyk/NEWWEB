/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/
<<<<<<< HEAD

=======
>>>>>>> f47ef2ac65efaf923d0459c5234ed08d4ca8a95b
"use strict";

const Source = require("./Source");

<<<<<<< HEAD
/** @typedef {import("./Source").Hash} Hash */
/** @typedef {import("./Source").MapOptions} MapOptions */
/** @typedef {import("./Source").RawSourceMap} RawSourceMap */
/** @typedef {import("./Source").SourceAndMap} SourceAndMap */
/** @typedef {import("./Source").SourceValue} SourceValue */

/**
 * @typedef {object} SourceLike
 * @property {() => SourceValue} source
 * @property {(() => Buffer)=} buffer
 * @property {(() => number)=} size
 * @property {((options?: MapOptions) => RawSourceMap | null)=} map
 * @property {((options?: MapOptions) => SourceAndMap)=} sourceAndMap
 * @property {((hash: Hash) => void)=} updateHash
 */

class CompatSource extends Source {
	/**
	 * @param {SourceLike} sourceLike source like
	 * @returns {Source} source
	 */
=======
class CompatSource extends Source {
>>>>>>> f47ef2ac65efaf923d0459c5234ed08d4ca8a95b
	static from(sourceLike) {
		return sourceLike instanceof Source
			? sourceLike
			: new CompatSource(sourceLike);
	}

<<<<<<< HEAD
	/**
	 * @param {SourceLike} sourceLike source like
	 */
=======
>>>>>>> f47ef2ac65efaf923d0459c5234ed08d4ca8a95b
	constructor(sourceLike) {
		super();
		this._sourceLike = sourceLike;
	}

<<<<<<< HEAD
	/**
	 * @returns {SourceValue} source
	 */
=======
>>>>>>> f47ef2ac65efaf923d0459c5234ed08d4ca8a95b
	source() {
		return this._sourceLike.source();
	}

	buffer() {
		if (typeof this._sourceLike.buffer === "function") {
			return this._sourceLike.buffer();
		}
		return super.buffer();
	}

	size() {
		if (typeof this._sourceLike.size === "function") {
			return this._sourceLike.size();
		}
		return super.size();
	}

<<<<<<< HEAD
	/**
	 * @param {MapOptions=} options map options
	 * @returns {RawSourceMap | null} map
	 */
=======
>>>>>>> f47ef2ac65efaf923d0459c5234ed08d4ca8a95b
	map(options) {
		if (typeof this._sourceLike.map === "function") {
			return this._sourceLike.map(options);
		}
		return super.map(options);
	}

<<<<<<< HEAD
	/**
	 * @param {MapOptions=} options map options
	 * @returns {SourceAndMap} source and map
	 */
=======
>>>>>>> f47ef2ac65efaf923d0459c5234ed08d4ca8a95b
	sourceAndMap(options) {
		if (typeof this._sourceLike.sourceAndMap === "function") {
			return this._sourceLike.sourceAndMap(options);
		}
		return super.sourceAndMap(options);
	}

<<<<<<< HEAD
	/**
	 * @param {Hash} hash hash
	 * @returns {void}
	 */
=======
>>>>>>> f47ef2ac65efaf923d0459c5234ed08d4ca8a95b
	updateHash(hash) {
		if (typeof this._sourceLike.updateHash === "function") {
			return this._sourceLike.updateHash(hash);
		}
		if (typeof this._sourceLike.map === "function") {
			throw new Error(
				"A Source-like object with a 'map' method must also provide an 'updateHash' method"
			);
		}
		hash.update(this.buffer());
	}
}

module.exports = CompatSource;
